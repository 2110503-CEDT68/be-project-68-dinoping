@startuml Post_Create_Reservation

title Create Reservation API Flow (POST)

actor User
participant "API Server" as API
database MongoDB

User -> API: POST /api/v1/restaurants/{restaurantId}/reservations\nBody: {reservationDate: Date}\nHeader: Authorization: token
activate API

API -> API: Verify JWT token
API -> API: Extract restaurant ID and user ID

API -> MongoDB: Verify restaurant exists
activate MongoDB
MongoDB --> API: Restaurant found/not found
deactivate MongoDB

alt Restaurant not found
  API --> User: 404 - Restaurant not found
else Restaurant exists
  API -> MongoDB: Count user's existing reservations
  activate MongoDB
  MongoDB --> API: Return count
  deactivate MongoDB
  
  alt Count >= 3 AND user is not admin
    API --> User: 400 - User already has 3 reservations
  else Count < 3 OR user is admin
    API -> MongoDB: Create new reservation
    activate MongoDB
    note right: Fields:\n- reservationDate\n- restaurant ID\n- user ID\n- createdAt
    MongoDB --> API: Reservation created
    deactivate MongoDB
    
    API --> User: 200 - Success\n{success: true,\ndata: reservation}
  end
end

deactivate API
